---
import { getPosts, getPrevAndLast } from "~/content/posts";
import type { BlogPost } from "~/content/posts";
import BaseLayout from "~/layouts/BaseLayout.astro";
import DefaultLayout from "~/layouts/DefaultLayout.astro";
import { formatDate } from "~/lib/formatter";

const [prevPost, nextPost] = await getPrevAndLast(Astro.url.pathname);

export async function getStaticPaths() {
  const blogPost = await getPosts();

  return blogPost.map((post) => ({
    params: { slug: post.slug },
    props: { entry: post },
  }));
}

const entry = Astro.props.entry as BlogPost;
const { Content } = await entry.render();
---

<BaseLayout
  title={entry.data.title}
  description={entry.data.description}
  keywords={entry.data.keywords}
>
  <DefaultLayout>
    <div class="mx-auto max-w-160 mb-10">
      <h1 class="text-3xl md:text-4xl font-bold tracking-tight text-neutral-900 dark:text-neutral-900 mb-4">
        {entry.data.title}
      </h1>

      <div class="flex items-center gap-3 text-sm text-neutral-600 dark:text-neutral-600">
        <time>{formatDate(entry.data.date)}</time>
        <span>・</span>
        <span>{entry.data.readingTime} min read</span>
      </div>
    </div>

    <article class="prose prose-lg dark:prose-invert max-w-160 mx-auto">
      <Content />
    </article>

    <div class="mx-auto max-w-160 mt-12 pt-8 border-t border-neutral-200 dark:border-neutral-400">
      <div class="flex flex-row justify-between items-center">
        {prevPost ? (
          <a href={prevPost.url} class="text-primary hover:text-primary-hover font-medium transition-colors">
            ← Prev post
          </a>
        ) : <span />}

        {nextPost ? (
          <a href={nextPost.url} class="text-primary hover:text-primary-hover font-medium transition-colors">
            Next post →
          </a>
        ) : <span />}
      </div>
    </div>
  </DefaultLayout>
</BaseLayout>

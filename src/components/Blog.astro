---
import { format } from "date-fns";
import Markdown from "@astrojs/markdown-component";
import calculateReadingTime from "../lib/calculateReadingTime";

const posts = (await Astro.glob("../pages/blog/*.md")).sort(
  (a, b) =>
    new Date(b.frontmatter.date).getTime() -
    new Date(a.frontmatter.date).getTime()
);
---

<ul class="space-y-10">
  {
    posts.map((post) => {
      const readingTime = calculateReadingTime(post.rawContent());
      const formattedDate = format(
        new Date(post.frontmatter.date),
        "MMMM d, yyyy"
      );

      return (
        <>
          <li class="pb-10 border-b border-wash-light border-solid">
            <a href={post.url}>
              <h3 class="text-xl text-accent">{post.frontmatter.title}</h3>
            </a>

            <small class="mt-2">
              {formattedDate} ãƒ» {readingTime} min read
            </small>

            <div class="mt-4 prose">
              <Markdown content={post.frontmatter.description} />
            </div>
          </li>
        </>
      );
    })
  }
</ul>

<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="title" property="og:title" content="Building and hosting a Discord bot - Francisco Sousa"><meta name="author" property="og:author" content="Francisco Sousa"><meta name="description" property="og:description" content="Discord is a great product that has been a source of joy for me, personally. This time, I'm gonna take you through all the steps needed to take your first Discord bot online, and host it safely on the cloud, for free."><meta name="keywords" content="tutorial, discord, bot, heroku, ruby, zeitwerk, sinatra"><meta name="twitter:card" content="summary"><meta name="twitter:title" property="twitter:title" content="Building and hosting a Discord bot - Francisco Sousa"><meta name="twitter:creator" property="twitter:creator" content="@goodxicosousa"><meta name="twitter:description" property="twitter:description" content="Discord is a great product that has been a source of joy for me, personally. This time, I'm gonna take you through all the steps needed to take your first Discord bot online, and host it safely on the cloud, for free."><meta name="twitter:url" property="twitter:url" content="https://jfranciscosousa.com/blog/posts/building-and-hosting-discord-bots/"><title>Building and hosting a Discord bot - Francisco Sousa</title><link rel="preconnect" href="https://jfranciscosousa.goatcounter.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://jfranciscosousa.goatcounter.com"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link href="/assets/styles/index.css" rel="stylesheet"><script defer="true" async="true" type="module" src="/assets/scripts/index.js"></script><script defer="true" async="true" type="module" src="/assets/scripts/pjax.js"></script><script defer="true" async="true" src="https://cdn.jsdelivr.net/npm/lazysizes@5/lazysizes.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"></head><body><div class="Page"><div class="Page-limitedWidth"><nav class="Nav"><div class="Nav-titleContainer"><h1 class="Nav-title"><a href="/">Francisco Sousa</a></h1><button class="ThemeToggle ThemeToggle-mobile" title="Toggle dark/light mode" onclick="window.handleThemeToggle()"></button></div><ul class="Nav-links"><li class="Nav-link"><a href="/">Home</a></li><li class="Nav-link"><a href="/about">About</a></li><li class="Nav-link"><a href="/projects">Projects</a></li><li class="Nav-link"><a href="/books">Bookshelf</a></li><li class="Nav-link"><a href="/blog/">Blog</a></li><li><button class="Nav-link ThemeToggle ThemeToggle-regular" title="Toggle dark/light mode" onclick="window.handleThemeToggle()"></button></li></ul></nav><main class="Blog-post"><h1>Building and hosting a Discord bot</h1><small>July 30, 2020 ãƒ» 14 min read</small><article class="Blog-content"><p>Discord is one of the premier instant communication platforms on the web right now. Free, easy to use, and just cool, Discord is one of the main hangout apps for gamers, developers, and just overall tech people. One of the coolest things about it is the ability to install bots on your servers that make some cool stuff. Bots that play music, text-based RPGs, dice rollers for RPGs (I made one), meme generators, and many more. In this blog post, I'm going to walk you through on all the steps needed to make your bot and host it for free (kinda free), provided you have some basic <code>ruby</code> and <code>git</code> knowledge.</p><h2>Getting started</h2><p>Why Ruby? Well, no reason at all. It's just my favorite language at the moment of writing. Its also the language I have been using at work for these past few years. And, I find it's just so simple and easy to understand for people who use it sparingly.</p><p>And why Heroku? It's a hosting platform that integrates with Github and automatically provides a CI/CD pipeline that continuously deploys your changes. This way you can make changes to your bot, commit that with <code>git</code> and your bot will just update itself on Heroku. We just need a little hack to make it work there but will get to that.</p><p>So some prerequisites:</p><ul><li>Discord account</li><li>Github account</li><li>Heroku account</li><li>Basic Ruby knowledge</li><li>Ruby (latest version) and Git installed and available on your path</li></ul><p>After you create all of these accounts, make sure you create a new Discord app. For that visit <a href="https://discord.com/developers" target="_blank" rel="noopener noreferrer">their developer portal</a>. Click <code>New Application</code> on the top right corner and follow along.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAYAAABxeg0vAAAAj0lEQVR4AW3BoQ7CMABF0duuq9xCMoMjwWEJhv//ADxuCsMIjNCOrX2kboJzzPF0Vs4ZSTRNi/eeTwhI4h/XbQ9kOcZHT/gG4pIoJMjLDBJr7nm/MsWJQhI5L2y6HTEMUNUYJWxV03Z7xqHHhU+gsNbiag943q8bBkgpIQmIxP5C4Vix1lJUlWOeZwpjDGs/HktF6HEAwBIAAAAASUVORK5CYII=" alt="Discord app client id" data-src="/images/discord1.png" class="lazyload" width="1519" height="659"></p><p>After creating it, on the bot's main page you can take note of the <code>CLIENT ID</code>, we are going to need it. Then go to the <code>Bot</code> tab on the side menu and. On that new screen, you can add a bot user to your application. Do it and take note of the <code>TOKEN</code> value also. All the other options are not needed for now, but you'll probably explore those later on as you develop your bot.</p><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAwAAAAFCAYAAABxeg0vAAAAoUlEQVR4AW3BsU0DQRCG0W9m17awHZEQuQdLyAE0QBX0QjO0QQ0UgTPLcnC2uN2b+dEFEPGePR6eFZlkBOvNlloLEYkZSPwxAwmquwFOCCQhXzD1b0zJf+rDbk+fCrfhxHg9kqtks7gj+0RrHUmAiEhmZbuub8Pli/F2xr3w9PpCSsR4j5UlbRxAwswwM2pE8Ku48/n+QesNMGbVDSjMIoIfDStM87W5oD8AAAAASUVORK5CYII=" alt="Discord bot token" data-src="/images/discord2.png" class="lazyload" width="1356" height="598"></p><h2>The bot</h2><p>Now make sure your directory dedicated to this project and also don't forget to initialize a git repo, we are going to need it. Now, like most ruby projects, let's start with a <code>Gemfile</code>.</p><pre class="language-ruby"><code class="language-ruby">source <span class="token string">"https://rubygems.org"</span><br><br>ruby <span class="token string">"2.7.1"</span><br><br>gem <span class="token string">"discordrb"</span><br>gem <span class="token string">"dotenv"</span><br>gem <span class="token string">"rake"</span><br>gem <span class="token string">"zeitwerk"</span></code></pre><p>After creating and saving this file, run <code>bundle install</code> to install these dependencies.</p><p>Now, what do these gems do? Let's go through them:</p><ul><li><code>discordrb</code> - this is a wrapper of the Discord API. We are going to need this to effectively communicate with Discord</li><li><code>dotenv</code> - we are going to use this to load the secret keys that we got from Discord</li><li><code>rake</code> - the classic ruby task runner. We are going to use this to start the app.</li><li><code>zeitwerk</code> - a class loader. We'll set up this soon.</li></ul><p>Now, let's write the code that will connect to discord and handle incoming commands. Let's place it on <code>src/discord_bot.rb</code>.</p><pre class="language-ruby"><code class="language-ruby"><span class="token keyword">module</span> <span class="token constant">DiscordBot</span><br>  <span class="token keyword">throw</span> <span class="token string">"Lacking required secrets!"</span> <span class="token keyword">unless</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"TOKEN"</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"CLIENT_ID"</span><span class="token punctuation">]</span><br><br>  <span class="token variable">@bot</span> <span class="token operator">=</span> <span class="token constant">Discordrb</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Bot</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">(</span><br>    token<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"TOKEN"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>    client_id<span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"CLIENT_ID"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><br>  <span class="token punctuation">)</span><br><br>  puts <span class="token string">"This bot's invite URL is <span class="token interpolation"><span class="token delimiter tag">#{</span><span class="token variable">@bot</span><span class="token punctuation">.</span>invite_url<span class="token delimiter tag">}</span></span>"</span><br>  puts <span class="token string">"Click on it to invite it to your server"</span><br><br>  <span class="token variable">@bot</span><span class="token punctuation">.</span>message<span class="token punctuation">(</span>with_text<span class="token punctuation">:</span> <span class="token string">"!ping"</span><span class="token punctuation">)</span> <span class="token keyword">do</span> <span class="token operator">|</span>event<span class="token operator">|</span><br>    event<span class="token punctuation">.</span>respond <span class="token string">"pong"</span><br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">run</span></span><br>    <span class="token variable">@bot</span><span class="token punctuation">.</span>run<br>  <span class="token keyword">end</span><br><br>  <span class="token keyword">def</span> <span class="token method-definition"><span class="token keyword">self</span><span class="token punctuation">.</span><span class="token function">invite_url</span></span><br>    <span class="token variable">@bot</span><span class="token punctuation">.</span>invite_url<br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre><p>We use the <code>discordrb</code> library to create a bot instance using the values from our shell environment.</p><p>Then, we define a handler for a bot command. The handler will intercept every message that matches <code>!ping</code> and respond to it with a <code>pong</code> message.</p><p>Then we just declare methods to run the bot and get the invite URL. The bot <code>run</code> method connects to Discord via a persistent websocket connection. That's how our bot reads all of the incoming messages from the servers it's installed in.</p><p>To correctly set the environment, create a file called <code>.env</code> and add the values you got on the Discord developer portal. The <code>dotenv</code> gem will take care of loading all of those values into the environment, just when we run our application. On Heroku we will define these variables on their dashboard. But for now, the <code>.env</code> file.</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">CLIENT_ID</span><span class="token operator">=</span>the client <span class="token function">id</span> you got on discord dev<br><span class="token assign-left variable">TOKEN</span><span class="token operator">=</span>the client secret you got on discord dev</code></pre><p><strong>DO NOT FORGET TO ADD THIS FILE TO THE GITIGNORE OF YOUR PROJECT</strong> otherwise, you are leaking secret information to the public.</p><p>Now to wrap everything up, let's write our <code>Rakefile</code> so that we can run our discord bot.</p><pre class="language-ruby"><code class="language-ruby"><span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"RUBY_ENV"</span><span class="token punctuation">]</span> <span class="token operator">||</span><span class="token operator">=</span> <span class="token string">"development"</span><br><span class="token keyword">require</span> <span class="token string">"bundler/setup"</span><br><span class="token keyword">require</span> <span class="token string">"dotenv/load"</span> <span class="token keyword">if</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"RUBY_ENV"</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">"production"</span><br><br><span class="token constant">Bundler</span><span class="token punctuation">.</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token symbol">:default</span><span class="token punctuation">,</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"RUBY_ENV"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><br>loader <span class="token operator">=</span> <span class="token constant">Zeitwerk</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Loader</span><span class="token punctuation">.</span>for_gem<br>loader<span class="token punctuation">.</span>push_dir<span class="token punctuation">(</span><span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/src"</span><span class="token punctuation">)</span><br>loader<span class="token punctuation">.</span>setup<br><br>task <span class="token symbol">:bot</span> <span class="token keyword">do</span><br>  <span class="token constant">DiscordBot</span><span class="token punctuation">.</span>run<br><span class="token keyword">end</span></code></pre><p>We wrap the entire file in a conditional that checks if we are running the file with ruby and not requiring it from another ruby file. This is usually done on ruby scripts that are meant to be executed from the command line.</p><p>Then we require the <code>bundler/setup</code>, so we can automatically require all the gems into the project. We then require <code>dotenv/load</code> only if we are outside of a production environment. During production, we don't want to load environment variables from the <code>.env</code> file, we just want to load them from the Heroku configuration.</p><p>We also set up <code>zeitwerk</code>, which will automatically require our own files. In this case, we have a <code>src/discord_bot.rb</code> file which defines a <code>DiscordBot</code> module. Check <a href="https://github.com/fxn/zeitwerk#file-structure" target="_blank" rel="noopener noreferrer">this link</a> for more info on Zeitwerk file structure. We push the <code>src</code> dir as a root dir for our code and then we run setup to load it.</p><p>Then we define the task to run the bot. Then, to start it, just run <code>bundle exec rake bot</code>. Now use the invite URL that shows up in the console and try it on your server! The bot should appear on the online user list and it should respond to a <code>!ping</code> message with <code>pong</code>.</p><h2>How to put this online</h2><p>Now the bot works great and it's even ready for deployment. You host this on any server that you might have handy. Just send this code over and run <code>rake bot</code>. But, most of us don't have handy servers there. This is where Heroku comes in.</p><p>Heroku is a hosting platform for web apps. <em>Web apps</em> is an important term. Meaning that Heroku expects that your app is an HTTP server of some sort, that binds to a port and responds to incoming request. If you deploy our code to Heroku, it will work for a couple of minutes before shutting down. This is because Heroku shuts down any app that does not bind to any port! So we just need to add a webserver to it.</p><h3>Sinatra</h3><p>We are going to spin up a very simple Sinatra webserver that will have a simple HTML page that will contain the invite URL for our bot. It's pretty useful stuff. You just share the Heroku app URL with your friends and they'll be able to invite the bot to their servers.</p><p>Let's go back to our Gemfile. Just the add <code>gem "sinatra"</code> to it and then run <code>bundle install</code> again.</p><p>Now let's set up our webserver. We need to create a folder at <code>src/webserver</code> and then one more subfolder at <code>src/webserver/views</code>. The <code>views</code> folder will hold all of our HTML templates. In this case, just one.</p><p>Then we create our HTML template at <code>src/webserver/views/index.erb</code>.</p><pre class="language-erb"><code class="language-erb"><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>width=device-width, initial-scale=1.0<span class="token punctuation">"</span></span> <span class="token punctuation">/&gt;</span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>The greatest bot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css"><br>      <span class="token selector">body</span> <span class="token punctuation">{</span><br>        <span class="token property">margin</span><span class="token punctuation">:</span> 40px auto<span class="token punctuation">;</span><br>        <span class="token property">max-width</span><span class="token punctuation">:</span> 650px<span class="token punctuation">;</span><br>        <span class="token property">line-height</span><span class="token punctuation">:</span> 1.6<span class="token punctuation">;</span><br>        <span class="token property">font-size</span><span class="token punctuation">:</span> 18px<span class="token punctuation">;</span><br>        <span class="token property">color</span><span class="token punctuation">:</span> #444<span class="token punctuation">;</span><br>        <span class="token property">padding</span><span class="token punctuation">:</span> 0 10px<span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>Greatest Bot<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><br>      I am the greatest bot. Add me to your server with my glorious<br>      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token erb language-erb"><span class="token delimiter punctuation">&lt;%=</span> <span class="token variable">@url</span> <span class="token delimiter punctuation">%&gt;</span></span></span><span class="token punctuation">&gt;</span></span>invite url<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>.<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><br><br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>p</span><span class="token punctuation">&gt;</span></span><br>      This is a good place to post instructions on how<br>      to use your bot by the way!<br>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>p</span><span class="token punctuation">&gt;</span></span><br>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span><br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre><p>Then create a <code>src/webserver.rb</code> file and a <code>src/webserver</code> folder. On our <code>src/webserver.rb</code> we are going to define the homepage route of our web app.</p><pre class="language-rb"><code class="language-rb"><span class="token keyword">class</span> <span class="token class-name">Webserver</span> <span class="token operator">&lt;</span> <span class="token constant">Sinatra</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Base</span><br>  set <span class="token symbol">:views</span><span class="token punctuation">,</span> <span class="token builtin">File</span><span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>__FILE__<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">"/webserver/views"</span><br><br>  get <span class="token string">"/"</span> <span class="token keyword">do</span><br>    <span class="token variable">@url</span> <span class="token operator">=</span> <span class="token constant">DiscordBot</span><span class="token punctuation">.</span>invite_url<br><br>    erb <span class="token symbol">:index</span><br>  <span class="token keyword">end</span><br><span class="token keyword">end</span></code></pre><p>When we receive a request on the <code>/</code> route, we set the <code>@url</code> with the bot's invite URL. Then we render the <code>index.erb</code>.</p><p>Finally, we just need to add another task to our <code>Rakefile</code> file to boot up the webserver and the bot at the same time. Add this to the <code>Rakefile</code>.</p><pre class="language-ruby"><code class="language-ruby">task <span class="token symbol">:web</span> <span class="token keyword">do</span><br>  <span class="token constant">Rack</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Server</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><br>    <span class="token constant">Port</span><span class="token punctuation">:</span> <span class="token constant">ENV</span><span class="token punctuation">[</span><span class="token string">"PORT"</span><span class="token punctuation">]</span> <span class="token operator">||</span> <span class="token number">4567</span><span class="token punctuation">,</span><br>    app<span class="token punctuation">:</span> <span class="token constant">Webserver</span><span class="token punctuation">.</span><span class="token keyword">new</span><span class="token punctuation">,</span><br>  <span class="token punctuation">)</span><br><span class="token keyword">end</span><br><br>task <span class="token symbol">:all</span> <span class="token keyword">do</span><br>  <span class="token constant">Process</span><span class="token punctuation">.</span>fork <span class="token punctuation">{</span> <span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">[</span><span class="token string">"bot"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>invoke <span class="token punctuation">}</span><br>  <span class="token constant">Process</span><span class="token punctuation">.</span>fork <span class="token punctuation">{</span> <span class="token constant">Rake</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">Task</span><span class="token punctuation">[</span><span class="token string">"web"</span><span class="token punctuation">]</span><span class="token punctuation">.</span>invoke <span class="token punctuation">}</span><br>  <span class="token constant">Process</span><span class="token punctuation">.</span>waitall<br><span class="token keyword">end</span></code></pre><p>The web task boots up a webserver that listens for requests at the port defined on our environment or 4657. By default, Heroku adds a <code>PORT</code> variable that holds the port we need to bind to. On the other hand, the <code>all</code> task spawns two processes that will run at the same time. One for the webserver and other for the Discord bot itself. This will allow us to run the entire thing for free, more details on that later.</p><p>During development, you can always just work on the bot or the webserver, or both at the same time.</p><p>The final step we need is to create the <code>Procfile</code>. On this file, we specify what Heroku will run. In this case, we want Heroku to run everything in one dyno, the <code>web</code> dyno. Heroku can run multiple <code>dynos</code> of different kinds. We could even have separate dynos, one for the bot and other for the webserver, but to fit on the free tier, we can only use one without running into limits.</p><pre class="language-ruby"><code class="language-ruby">web<span class="token punctuation">:</span> rake all</code></pre><p>Now, to run the bot and the server at the same time do <code>rake all</code>. This will start both scripts and it will display its outputs on different colors. Very useful for debugging and seeing what's happening. Oh, and you can visit your shiny website at <a href="http://localhost:5000" target="_blank" rel="noopener noreferrer">http://localhost:5000</a>.</p><p>Remember, that with this setup you can always run just the bot or just the webserver locally. <code>rake bot</code> or <code>rake web</code> will do the trick. Just in case you don't want to work on the entire thing.</p><h3>Heroku</h3><p>Now, to deploy all of this to Heroku make sure you have all of this code on a Github repo. Then create a new app on Heroku and use the <code>Connect with Github</code> function. Then just follow to connect with your Github repo. Finally, click the <code>Deploy branch</code> button to deploy your code. You can optionally enable automatic deploys so every time you commit to master, you trigger a new build.</p><p>Your app will probably not work right away. You need to set the correct environment variables for it to work. Go to the <code>Settings</code> tab on Heroku. Then on the <code>Config Vars</code> zone click reveal and then introduce the following variables:</p><pre class="language-bash"><code class="language-bash"><span class="token assign-left variable">RUBY_ENV</span><span class="token operator">=</span>production<br><span class="token assign-left variable">CLIENT_ID</span><span class="token operator">=</span>your client <span class="token function">id</span> from discord dev portal<br><span class="token assign-left variable">TOKEN</span><span class="token operator">=</span>your secret token <span class="token function">id</span> from discord dev portal</code></pre><p>You can use the same values you have on your <code>.env</code> file for the discord secrets. But note that is a best practice to have different apps and different values for the development and production build. If your bot is used by many people, it's probably a bad idea to use the same bot app during development, because it's already running an instance on Heroku and it might introduce downtime for its users. But all it takes is just creating another app as we did earlier, and use those new credentials here on Heroku.</p><p>After setting the environment variables, Heroku should automatically re-release the app. Click the <code>Open App</code> in the top-right area. It should take you to the website with the invite URL. Use it for your server, then test the bot as you did during development. By the way, the server on your own machine, in case you are using the same credentials for both production (Heroku) and development, just to make sure there are no interferences.</p><h3>Disclaimer</h3><p>Heroku offers a <em>hobby</em> tier that allows you to host an app for free, provided it runs only a few hours per day. Heroku automatically kills your app after it idles for a while. That's based on web requests, so even if people are using the bot on Discord, that doesn't count as traffic for Heroku. Our bot uses websockets to send and receive messages from Discord, so that doesn't count for Heroku. More info on <a href="https://link" target="_blank" rel="noopener noreferrer">their docs page</a> about the free tier.</p><p>Though, if you add a credit card to your account to validate it, you get enough hours to run a single dyno the entire month 24/7. By fitting all of our tasks into the <code>rake all</code> task, we can just consume hours in a single dyno. Not ideal, but it works for our use case.</p><h2>Next Steps</h2><p>Now the bot is up running, but it doesn't do much. The hardest part of getting it up and running on the outside world is done, but now it's up to you to fill the rest in.</p><p>You should take a look at <code>discordrb</code> <a href="https://github.com/discordrb/discordrb/wiki" target="_blank" rel="noopener noreferrer">wiki page</a> and also their <a href="https://www.rubydoc.info/github/meew0/discordrb/Discordrb" target="_blank" rel="noopener noreferrer">API documentation</a> for more advanced stuff. Their API is plenty easy to work with.</p><p>You may also see a "real" bot in action using this template and these libraries. I made a bot a while back to roll dice. I use it just for fun and some online Dungeons &amp; Dragons sessions. You can check the code <a href="https://github.com/jfranciscosousa/dicer" target="_blank" rel="noopener noreferrer">here on my Github repo</a> and you can also invite it to your server by visiting <a href="https://thedicer.herokuapp.com" target="_blank" rel="noopener noreferrer">it's home page</a>.</p><h2>A final note</h2><p>This will work for hobby projects of sorts, but any bot with a significant amount of servers will perhaps need a little more horsepower to run, and the hobby tier from Heroku won't cut it. Also, running two processes on one dyno is not the best way to go about a performant. But hey! We usually say that "premature optimization is the root of all evil", so don't sweat it. When things get slow, just split off the webserver and the bot in different dynos and boost them (that won't be free anymore though).</p><p>I packaged the teachings of this blog post into a starter repo that you can use instead of following these steps. I'll keep that repo updated but there might be the chance that the code is slightly different. People might find better ways to do things and I'll happily accept that! Anyway, the repo's README will get you sorted. Check it at <a href="https://github.com/jfranciscosousa/discordrb-template" target="_blank" rel="noopener noreferrer">my Github repo</a>.</p><p>Have fun!</p></article><div class="Blog-footer"><a class="Blog-seeMore" href="/blog">See more posts</a><p>Want to talk about this? Feel free to reach me on the web:</p><ul class="Social"><li class="Social-item"><a target="_blank" rel="noopener" href="https://twitter.com/goodxicosousa" aria-label="Twitter"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/jfranciscosousa/" aria-label="LinkedIn"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="https://github.com/jfranciscosousa" aria-label="Github"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="mailto:francisco.sousa@hey.com" aria-label="Mail"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="/blog/feed.xml" aria-label="RSS feed"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></div></a></li></ul></div></main></div></div><script>
            (function (selector, src, preferNativeLazyLoad) {
  var images = document.querySelectorAll(selector);
  var numImages = images.length;

  if (numImages > 0) {
    if (preferNativeLazyLoad && 'loading' in HTMLImageElement.prototype) {
      for (var i = 0; i < numImages; i++) {
        var keys = ['src', 'srcset'];

        for (var j = 0; j < keys.length; j++) {
          if (images[i].hasAttribute('data-' + keys[j])) {
            var value = images[i].getAttribute('data-' + keys[j]);
            images[i].setAttribute(keys[j], value);
          }
        }
      }

      return;
    }

    var script = document.createElement('script');
    script.async = true;
    script.src = src;
    document.body.appendChild(script);
  }
})(
              'img',
              'https://cdn.jsdelivr.net/npm/lazysizes@5/lazysizes.min.js',
              false
            );
          </script></body></html>
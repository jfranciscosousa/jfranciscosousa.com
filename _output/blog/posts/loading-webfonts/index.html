<!DOCTYPE html><html lang="en" class="no-js"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="title" property="og:title" content="Dealing with webfont loading - Francisco Sousa"><meta name="author" property="og:author" content="Francisco Sousa"><meta name="description" property="og:description" content="Webfonts are amazing, but most websites using them suffer from weird layout shifts and flashes of unstyled or inivisble text. Let's dive in on ways to attenuate that and make your initial website load smoother."><meta name="keywords" content="webfonts, foit, fout, google fonts, typekit, web development, web design"><meta name="twitter:card" content="summary"><meta name="twitter:title" property="twitter:title" content="Dealing with webfont loading - Francisco Sousa"><meta name="twitter:creator" property="twitter:creator" content="@goodxicosousa"><meta name="twitter:description" property="twitter:description" content="Webfonts are amazing, but most websites using them suffer from weird layout shifts and flashes of unstyled or inivisble text. Let's dive in on ways to attenuate that and make your initial website load smoother."><meta name="twitter:url" property="twitter:url" content="https://jfranciscosousa.com/blog/posts/loading-webfonts/"><title>Dealing with webfont loading - Francisco Sousa</title><link rel="preconnect" href="https://jfranciscosousa.goatcounter.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://jfranciscosousa.goatcounter.com"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link href="/assets/styles/index.css" rel="stylesheet"><script defer="true" async="true" type="module" src="/assets/scripts/index.js"></script><script defer="true" async="true" type="module" src="/assets/scripts/pjax.js"></script><script defer="true" async="true" src="https://cdn.jsdelivr.net/npm/lazysizes@5/lazysizes.min.js"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Mulish:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&amp;display=swap"></head><body><div class="Page"><div class="Page-limitedWidth"><nav class="Nav"><div class="Nav-titleContainer"><h1 class="Nav-title"><a href="/">Francisco Sousa</a></h1><button class="ThemeToggle ThemeToggle-mobile" title="Toggle dark/light mode" onclick="window.handleThemeToggle()"></button></div><ul class="Nav-links"><li class="Nav-link"><a href="/">Home</a></li><li class="Nav-link"><a href="/about">About</a></li><li class="Nav-link"><a href="/projects">Projects</a></li><li class="Nav-link"><a href="/books">Bookshelf</a></li><li class="Nav-link"><a href="/blog/">Blog</a></li><li><button class="Nav-link ThemeToggle ThemeToggle-regular" title="Toggle dark/light mode" onclick="window.handleThemeToggle()"></button></li></ul></nav><main class="Blog-post"><h1>Dealing with webfont loading</h1><small>June 25, 2020 ãƒ» 6 min read</small><article class="Blog-content"><p>The time has come to implement a beautiful website design. It has a great Webfont. So you go to Google Fonts or Adobe's Typekit or you just buy one and self host it. But once you start writing code and previewing its results, you notice one <em>little</em> pickle: the whole website shifts, flashes, and janks all over the place when refreshed or opened from a cold cache. It ain't pretty. Let's see how we can attenuate those effects.</p><h2>FOIT &amp; FOUT</h2><p>FOIT and FOUT are acronyms likely to pop up when you search for the issues above. If you haven't heard of them before, this is what they mean:</p><ul><li>FOIT - flash of invisible text. When the website has no fonts rendered until the web font loads.</li><li>FOUT - flash of unstyled text. When the whole typography flashes from an unstyled state to your web font style.</li></ul><p>Examples of FOIT (left) and FOUT (right).</p><p><img src="data:image/gif;base64,[object Promise]" alt="FOIT vs FOUT" data-src="/images/fonts-side-by-side.gif" class="lazyload" width="600" height="264"></p><p>These issues are manifestations of a root problem. What the hell does your browser do while your web font loads?</p><p>Let's remember what <code>font-family</code> does:</p><pre class="language-css"><code class="language-css"><span class="token selector">html</span> <span class="token punctuation">{</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"MyRadWebfont"</span><span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>You are telling the browser to use <code>MyRadWebFont</code> first, then <code>Arial</code> and, if none of these are available, any <code>sans-serif</code> font the user's device might have. <code>Arial</code> is a safe bet because it's a font that's included in every major browser.</p><p>While the web font is loading, you either get a FOIT or FOUT. It usually depends on the user's browser. A couple of years ago, most browsers applied the FOIT approach, detecting if the website is using a web font and then waiting for it until it becomes available and then swapping the invisible text with the font. Then, some browsers (mainly Firefox) started defaulting to the FOUT approach, to make sure users could see some text while fonts loaded.</p><p>At the time, if you wanted control over this behavior, you had to do it yourself with custom Javascript. Nowadays, there's an easy way to do it.</p><h2><code>font-display</code> to the rescue</h2><p><code>font-display</code> is a somewhat recent CSS property that can be used to control the way web fonts are loaded and how their fallback is handled. It has awesome <a href="https://caniuse.com/#search=font-display" target="_blank" rel="noopener noreferrer">browser support</a>. However, it doesn't work on IE. What a surprise.</p><p>The property takes on these values:</p><ul><li><strong>block</strong> - renders nothing at first, then shows the web font. If the web font loading timeouts, it shows the fallback font. An expected FOIT;</li><li><strong>swap</strong> - renders the fallback, then swaps when the web font is loaded. An expected FOUT;</li><li><strong>fallback</strong> - same as swap, but if the web font takes too long to load, it doesn't swap and it keeps the fallback. FOUT if it doesn't timeout;</li><li><strong>optional</strong> - same as fallback, but the browser <em>decides</em> if the ideal conditions to download web fonts are present. On a slow internet connection, for example, the browser won't download it.</li></ul><p>This is the gist of it. You can check out Monica's in-depth explanation, demo, and talk <a href="https://font-display.glitch.me/" target="_blank" rel="noopener noreferrer">on this website</a>.</p><p>Still, the same FOIT and FOUT happen, but now at least it's predictable. And you ensure all users will get the same behavior (as long as their browsers support the <code>font-display</code>).</p><p>If you don't use <strong>Google Fonts</strong>, you might be unable to specify a <code>font-display</code> property. Most font providers give you a CSS file with <code>@font-face</code> declarations that you cannot modify, meaning you cannot add the <code>font-display</code> property to it. This is an issue with Typekit (which I use at work all the time), where you cannot apply the <code>font-display</code> property. If you self host your fonts though, all is fine.</p><p>Then the only solution that's left is actually handling this stuff with Javascript. Controversial, but I'm gonna try and spin up a solution with a progressive enhancement mindset. Works great if you have JS, still works as expected without JS.</p><h2>Smoothing out the FOIT</h2><p>I've had this idea where we knowingly apply a FOIT, by hiding the entire website until the font is available, and then fading in the entire thing. The regular FOIT behavior is a bit ugly, because you still have parts of the website rendered and then the whole thing janks and becomes visible. With this, we nicely fade in the entire website and avoid layout shifts.</p><p>We can use the <code>opacity</code> property for that and then we'll apply a simple <code>transition</code>. All with CSS. Then we somehow apply these styles with JS after the font is loaded.</p><p>So, I'll exemplify with what is powering my own website. The source code is available on <a href="https://github.com/jfranciscosousa/jfranciscosousa.com" target="_blank" rel="noopener noreferrer">my Github repo</a>, which is an Eleventy + Webpack project.</p><p>First, we need to set up <a href="https://github.com/bramstein/fontfaceobserver" target="_blank" rel="noopener noreferrer">fontfaceobserver</a>, either with your favorite JS package manager or by adding it via <a href="https://cdnjs.com/libraries/fontfaceobserver" target="_blank" rel="noopener noreferrer">CDN</a>. Works on IE with a <code>Promise</code> polyfill. It's a small dependency, just 1.3kb gzipped.</p><p>The code:</p><pre class="language-js"><code class="language-js"><span class="token comment">// if you can't require packages, load it via a CDN</span><br><span class="token keyword">const</span> FontFaceObserver <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">"fontfaceobserver"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">const</span> htmlElement <span class="token operator">=</span> document<span class="token punctuation">.</span>documentElement<span class="token punctuation">;</span><br><br>htmlElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"no-js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>htmlElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"has-js"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><br><span class="token keyword">function</span> <span class="token function">applyHasFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  htmlElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">remove</span><span class="token punctuation">(</span><span class="token string">"no-font"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  htmlElement<span class="token punctuation">.</span>classList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token string">"has-font"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token keyword">new</span> <span class="token class-name">FontFaceObserver</span><span class="token punctuation">(</span><span class="token string">"Muli"</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><br>    <span class="token function">applyHasFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span><span class="token punctuation">)</span><br>  <span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token function">applyHasFont</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre><p>With this, we replace a <code>no-js</code> class with a <code>has-js</code> class when the script is loaded. Then, we replace a <code>no-font</code> with a <code>has-font</code> class when we load our font, <code>Muli</code>. We also apply the <code>has-font</code> class after a 2-second timeout, just in case the user's internet is really slow and can't download the font in an acceptable time. The second argument of the <code>FontFaceObserver</code> constructor is the desired timeout in milliseconds. After that time elapses, the <code>load</code> function errors.</p><p>Then, on the CSS side of things:</p><pre class="language-css"><code class="language-css"><span class="token atrule"><span class="token rule">@import</span> <span class="token url"><span class="token function">url</span><span class="token punctuation">(</span><span class="token string url">"https://fonts.googleapis.com/css2?family=Muli:wght@200..900&amp;display=swap"</span><span class="token punctuation">)</span></span><span class="token punctuation">;</span></span><br><br><span class="token selector">html</span> <span class="token punctuation">{</span><br>  <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Muli"</span><span class="token punctuation">,</span> Arial<span class="token punctuation">,</span> sans-serif<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.has-js.no-font body</span> <span class="token punctuation">{</span><br>  <span class="token property">opacity</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span><br><span class="token punctuation">}</span><br><br><span class="token selector">.has-js.has-font body</span> <span class="token punctuation">{</span><br>  <span class="token property">opacity</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span><br><br>  <span class="token property">transition</span><span class="token punctuation">:</span> opacity 0.5s<span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre><p>Also don't forget to add the default classes to the HTML document:</p><pre class="language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>no-js no-font<span class="token punctuation">"</span></span><span class="token punctuation">&gt;</span></span><br>  ...<br><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span></code></pre><p>Notice that we only apply the styles <strong>if</strong> we have JS. This way, people that (for some reason) have their Javascript disabled, still can see the website. We are passing <code>display=swap</code> to the Google Fonts API, so that on the lack of Javascript, this will fall back to the <code>swap</code> behavior.</p><h2>Wrapping up</h2><p>I hope this post has been helpful. Personally, I avoid reinventing the wheel with JS for features that can be handled with just CSS, but in this case, a nice compromise can be reached. It respects all users in terms of connection speed and Javascript capabilities and supports different browsers.</p></article><div class="Blog-footer"><a class="Blog-seeMore" href="/blog">See more posts</a><p>Want to talk about this? Feel free to reach me on the web:</p><ul class="Social"><li class="Social-item"><a target="_blank" rel="noopener" href="https://twitter.com/goodxicosousa" aria-label="Twitter"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="https://www.linkedin.com/in/jfranciscosousa/" aria-label="LinkedIn"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-linkedin"><path d="M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z"></path><rect x="2" y="9" width="4" height="12"></rect><circle cx="4" cy="4" r="2"></circle></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="https://github.com/jfranciscosousa" aria-label="Github"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-github"><path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="mailto:francisco.sousa@hey.com" aria-label="Mail"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-mail"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path><polyline points="22,6 12,13 2,6"></polyline></svg></div></a></li><li class="Social-item"><a target="_blank" rel="noopener" href="/blog/feed.xml" aria-label="RSS feed"><div class="Social-icon"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></div></a></li></ul></div></main></div></div><script>
            (function (selector, src, preferNativeLazyLoad) {
  var images = document.querySelectorAll(selector);
  var numImages = images.length;

  if (numImages > 0) {
    if (preferNativeLazyLoad && 'loading' in HTMLImageElement.prototype) {
      for (var i = 0; i < numImages; i++) {
        var keys = ['src', 'srcset'];

        for (var j = 0; j < keys.length; j++) {
          if (images[i].hasAttribute('data-' + keys[j])) {
            var value = images[i].getAttribute('data-' + keys[j]);
            images[i].setAttribute(keys[j], value);
          }
        }
      }

      return;
    }

    var script = document.createElement('script');
    script.async = true;
    script.src = src;
    document.body.appendChild(script);
  }
})(
              'img',
              'https://cdn.jsdelivr.net/npm/lazysizes@5/lazysizes.min.js',
              false
            );
          </script></body></html>